<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style type="text/css">
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
        }
        .axis text {
            font-family: sans-serif;
            font-size: 12px;

        }
    </style>
</head>
<body>
    <script type="module">
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

        const NetflixData = (callback) => {
        d3.csv("netflix_titles.csv").then((data) => {
        let dataset = data
            .filter(d => d.director && d.director.trim() !== "")  // Filter out entries with empty or undefined director                
            .map((d) => {
                                return {
                                    // show_id,type,title,director,cast,country,date_added,release_year,rating,duration,listed_in,description
                                    type: d.type,           //string
                                    title: d.title,         //string
                                    director: d.director,   //string or Array of strings
                                    cast: d.cast,           //Array Of strings
                                    country: d.country,     //string or array of strings
                                    date_added: d.date_added, //string
                                    release_year: d.release_year, //number
                                    rating: d.rating,               //string
                                    duration: d.duration,       //string
                                    listed_in: d.listed_in,     //string or array of strings
                                    description: d.description, //list of strings
                                    
                                };
                        }); 
        callback(dataset);
    });      
};

function visualizeDurationCountsHistogram(data) {
    
    let h = 500;
    let w = 600;
    let padding = 50;

    let svg = d3.select("body")
                .append("svg")
                .attr("height", h + 70)
                .attr("width", w);


    //***Duration/Counts Histogram***//
    let durationCounts = d3.rollup(data, v => v.length, d => d.duration);

     // Sorting the durations cuz we cant display all the durations (Too much)
     let sortedDurations = Array.from(durationCounts.entries())
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15); // Top15

    let xScale = d3.scaleBand()
        // .domain(Array.from(durationCounts.keys()))
        .domain(sortedDurations.map(d => d[0]))
        .range([padding, w - padding])
        .padding(0.1);

    let maxCountDurations = d3.max(sortedDurations, d => d[1])

    let yScale = d3.scaleLinear()
        //.domain([0, d3.max(durationCounts.values())])
        .domain([0,maxCountDurations + 0.05*maxCountDurations ])
        .range([h - padding, padding]);

    let bars = svg.selectAll("rect")   
                // .data(durationCounts.entries())
                .data(sortedDurations)
                .enter()
                .append("rect")
                .attr("x", d => xScale(d[0]))
                .attr("y", d => yScale(d[1]))
                .attr("width", xScale.bandwidth())
                .attr("height", d => h - padding - yScale(d[1]))
                .attr("fill", "purple");


    // Add labels on top of each rectangle
    let labels = svg.selectAll("text")
                    .data(sortedDurations)
                    .enter()
                    .append("text")
                    .text(d => d[1]) 
                    .attr("x", d => xScale(d[0]) + xScale.bandwidth() / 2)
                    .attr("y", d => yScale(d[1]) - 5) 
                    .attr("text-anchor", "middle")
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "12px")
                    .attr("font-weight", "700") 
                    .attr("fill", "black")
                    .style("opacity", 0);
                    

    // Show labels on hover
    bars.on("mouseover", function (event, d) {
        d3.select(this).attr("fill", "orange"); 
        labels.filter(label => label === d)
            .style("opacity", 1); 
    })
        .on("mouseout", function (event, d) {
            d3.select(this).attr("fill", "purple"); 
            labels.filter(label => label === d)
                .style("opacity", 0); 
        });

    // x-axis
    svg.append("g")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(d3.axisBottom(xScale))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("font-weight", 600)
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)");

    // y-axis
    svg.append("g")
        .attr("transform", "translate(" + padding + ",0)")
        .call(d3.axisLeft(yScale))
        .selectAll("text")
        .attr("font-weight", 600);

    svg.append("text")
        .attr("x", w / 2)
        .attr("y", h + 60 ) // Adjust the position based on your preference
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("Highest 15 Shows & movies Duration Counts");
}

function visualizeDateAddedCountsHistogram(data) {
    
    let h = 500;
    let w = 600;
    let padding = 50;

    let svg = d3.select("body")
                .append("svg")
                .attr("height", h + 70)
                .attr("width", w);



    //***Date_Added/Counts Histogram***//

    let dateAddedCounts = d3.rollup(data, v => v.length, d => d.date_added);

    // Sorting release years in descending order
    let sortedDateAdded = Array.from(dateAddedCounts.keys()).sort((a, b) => b - a);

    // Select the last 15 release years
    let last15DateAdded = sortedDateAdded.slice(0, 15);

    let xScaleDateAdded = d3.scaleBand()
        .domain(last15DateAdded)
        .range([padding, w - padding])
        .padding(0.1);

    let maxDateAddedCounts = d3.max(last15DateAdded.map(year => dateAddedCounts.get(year))) || 0;

    let yScaleDateAdded = d3.scaleLinear()
        .domain([0, maxDateAddedCounts + 0.05 * maxDateAddedCounts])
        .range([h - padding, padding]);

    svg.selectAll(".date-added-rect")
        .data(last15DateAdded.map(year => [year, dateAddedCounts.get(year)]))
        .enter()
        .append("rect")
        .attr("class", "date-added-rect")
        .attr("x", d => xScaleDateAdded(d[0]))
        .attr("y", d => h - padding)
        .attr("width", xScaleDateAdded.bandwidth())
        .attr("height", 0) 
        .attr("fill", "purple")
        .transition() 
        .duration(1000) 
        .attr("y", d => yScaleDateAdded(d[1]))
        .attr("height", d => h - padding - yScaleDateAdded(d[1]));

    svg.selectAll(".date-added-label")
        .data(last15DateAdded.map(year => [year, dateAddedCounts.get(year)]))
        .enter()
        .append("text")
        .attr("class", "date-added-label")
        .text(d => d[1])
        .attr("x", d => xScaleDateAdded(d[0]) + xScaleDateAdded.bandwidth() / 2)
        .attr("y", d => yScaleDateAdded(d[1]) - 5)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("font-weight", "700")
        .attr("fill", "black")
        .style("opacity", 0);

    svg.selectAll(".date-added-rect")
        .on("mouseenter", function (event, d) {
            d3.select(this).attr("fill", "orange");
            svg.selectAll(".date-added-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 1);
        })
        .on("mouseleave", function (event, d) {
            d3.select(this).attr("fill", "purple");
            svg.selectAll(".date-added-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 0);
        });

    // x-axis
    svg.append("g")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(d3.axisBottom(xScaleDateAdded))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("font-weight", 600)
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)");

    // y-axis
    svg.append("g")
        .attr("transform", "translate(" + padding + ",0)")
        .call(d3.axisLeft(yScaleDateAdded))
        .selectAll("text")
        .attr("font-weight", 600);
    
    svg.append("text")
        .attr("x", w / 2)
        .attr("y", h + 60 ) 
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("Last 15 date added Counts");
}

function visualizeReleaseYearCountsHistogram(data) {

    let h = 500;
    let w = 600;
    let padding = 50;

    let svg = d3.select("body")
                .append("svg")
                .attr("height", h + 70)
                .attr("width", w);



    //***Release_year/Counts Histogram***//

    let releaseYearCounts = d3.rollup(data, v => v.length, d => d.release_year);

    // Sorting release years in descending order
    let sortedReleaseYears = Array.from(releaseYearCounts.keys()).sort((a, b) => b - a);

    // Select the last 15 release years
    let last15ReleaseYears = sortedReleaseYears.slice(0, 15);

    let xScaleReleaseYear = d3.scaleBand()
        .domain(last15ReleaseYears)
        .range([padding, w - padding])
        .padding(0.1);

    let maxReleaseYearCounts = d3.max(last15ReleaseYears.map(year => releaseYearCounts.get(year))) || 0;

    let yScaleReleaseYear = d3.scaleLinear()
        .domain([0, maxReleaseYearCounts + 0.05 * maxReleaseYearCounts])
        .range([h - padding, padding]);

    svg.selectAll(".release-year-rect")
        .data(last15ReleaseYears.map(year => [year, releaseYearCounts.get(year)]))
        .enter()
        .append("rect")
        .attr("class", "release-year-rect")
        .attr("x", d => xScaleReleaseYear(d[0]))
        .attr("y", d => h - padding)
        .attr("width", xScaleReleaseYear.bandwidth())
        .attr("height", 0) 
        .attr("fill", "steelblue")
        .transition() 
        .duration(1000) 
        .attr("y", d => yScaleReleaseYear(d[1]))
        .attr("height", d => h - padding - yScaleReleaseYear(d[1]));

    svg.selectAll(".release-year-label")
        .data(last15ReleaseYears.map(year => [year, releaseYearCounts.get(year)]))
        .enter()
        .append("text")
        .attr("class", "release-year-label")
        .text(d => d[1])
        .attr("x", d => xScaleReleaseYear(d[0]) + xScaleReleaseYear.bandwidth() / 2)
        .attr("y", d => yScaleReleaseYear(d[1]) - 5)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("font-weight", "700")
        .attr("fill", "black")
        .style("opacity", 0);

    svg.selectAll(".release-year-rect")
        .on("mouseenter", function (event, d) {
            d3.select(this).attr("fill", "orange");
            svg.selectAll(".release-year-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 1);
        })
        .on("mouseleave", function (event, d) {
            d3.select(this).attr("fill", "steelblue");
            svg.selectAll(".release-year-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 0);
        });

    // x-axis
    svg.append("g")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(d3.axisBottom(xScaleReleaseYear))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("font-weight", 600)
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)");

    // y-axis
    svg.append("g")
        .attr("transform", "translate(" + padding + ",0)")
        .call(d3.axisLeft(yScaleReleaseYear))
        .selectAll("text")
        .attr("font-weight", 600);
    
    svg.append("text")
        .attr("x", w / 2)
        .attr("y", h + 60) 
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("Last 15 Years Release Year Counts");
}

function visualizeRatingCountsHistogram(data){
    let h = 500;
    let w = 600;


    let svg = d3.select("body")
        .append("svg")
        .attr("height", h + 70) // Increased height to accommodate the title
        .attr("width", w);

    let padding = 50;

    //***Rating/Counts Histogram***//

    let ratingCounts = d3.rollup(data, v => v.length, d => d.rating);

    let sortedRatings = Array.from(ratingCounts.keys()).sort();

    let xScaleRating = d3.scaleBand()
        .domain(sortedRatings)
        .range([padding, w - padding])
        .padding(0.1);

    let maxRatingCounts = d3.max(sortedRatings.map(rating => ratingCounts.get(rating))) || 0;

    let yScaleRating = d3.scaleLinear()
        .domain([0, maxRatingCounts + 0.05 * maxRatingCounts])
        .range([h - padding, padding]);

    svg.selectAll(".rating-rect")
        .data(sortedRatings.map(rating => [rating, ratingCounts.get(rating)]))
        .enter()
        .append("rect")
        .attr("class", "rating-rect")
        .attr("x", d => xScaleRating(d[0]))
        .attr("y", d => h - padding)
        .attr("width", xScaleRating.bandwidth())
        .attr("height", 0) 
        .attr("fill", "green")
        .transition() 
        .duration(1000) 
        .attr("y", d => yScaleRating(d[1]))
        .attr("height", d => h - padding - yScaleRating(d[1]));

    svg.selectAll(".rating-label")
        .data(sortedRatings.map(rating => [rating, ratingCounts.get(rating)]))
        .enter()
        .append("text")
        .attr("class", "rating-label")
        .text(d => d[1])
        .attr("x", d => xScaleRating(d[0]) + xScaleRating.bandwidth() / 2)
        .attr("y", d => yScaleRating(d[1]) - 5)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("font-weight", "700")
        .attr("fill", "black")
        .style("opacity", 0);

    svg.selectAll(".rating-rect")
        .on("mouseenter", function (event, d) {
            d3.select(this).attr("fill", "orange");
            svg.selectAll(".rating-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 1);
        })
        .on("mouseleave", function (event, d) {
            d3.select(this).attr("fill", "green");
            svg.selectAll(".rating-label")
                .filter(label => label[0] === d[0])
                .style("opacity", 0);
        });

   
    svg.append("g")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(d3.axisBottom(xScaleRating))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("font-weight", 600)
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)")
        .attr("font-size", "10px"); 

    svg.append("g")
        .attr("transform", "translate(" + padding + ",0)")
        .call(d3.axisLeft(yScaleRating))
        .selectAll("text")
        .attr("font-weight", 600);

    svg.append("text")
        .attr("x", w / 2)
        .attr("y", h + 60)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("All Ratings Counts");
}

function visualizeTopDirectorsHistogram(data) {
    let h = 500;
    let w = 600;

    let svg = d3.select("body")
        .append("svg")
        .attr("height", h + 70) // Increased height to accommodate the title
        .attr("width", w);

    let padding = 50;

    //***Top Directors/Title Counts Histogram***//
    // dont forget when fetching the director data that there are some title shaving multiple directors
    // Create an object to store counts for each director
    let directorCounts = {};

    // Count titles for each director
    data.forEach(d => {
        let directors = d.director.split(/\s*,\s*/);
        directors.forEach(dir => {
            if (directorCounts[dir]) {
                directorCounts[dir]++;
            } else {
                directorCounts[dir] = 1;
            }
        });
    });

    // Convert the object into an array of [director, count]
    let sortedDirectors = Object.entries(directorCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 15);

    let xScaleDirectors = d3.scaleBand()
        .domain(sortedDirectors.map(d => d[0]))
        .range([padding, w - padding])
        .padding(0.1);

    let maxDirectorCounts = d3.max(sortedDirectors, d => d[1]) || 0;

    let yScaleDirectors = d3.scaleLinear()
        .domain([0, maxDirectorCounts + 0.05 * maxDirectorCounts])
        .range([h - padding, padding]);

    svg.selectAll(".director-rect")
        .data(sortedDirectors)
        .enter()
        .append("rect")
        .attr("class", "director-rect")
        .attr("x", d => xScaleDirectors(d[0]))
        .attr("y", d => h - padding)
        .attr("width", xScaleDirectors.bandwidth())
        .attr("height", 0)
        .attr("fill", "blue")
        .transition()
        .duration(1000)
        .attr("y", d => yScaleDirectors(d[1]))
        .attr("height", d => h - padding - yScaleDirectors(d[1]));

    svg.selectAll(".director-label")
        .data(sortedDirectors)
        .enter()
        .append("text")
        .attr("class", "director-label")
        .text(d => d[1])
        .attr("x", d => xScaleDirectors(d[0]) + xScaleDirectors.bandwidth() / 2)
        .attr("y", d => yScaleDirectors(d[1]) - 5)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("font-weight", "700")
        .attr("fill", "black")
        .style("opacity", 0);

    svg.selectAll(".director-rect")
        .on("mouseenter", function (event, d) {
            d3.select(this).attr("fill", "orange");
            svg.selectAll(".director-label")
                .filter(label => label === d)
                .style("opacity", 1);
        })
        .on("mouseleave", function (event, d) {
            d3.select(this).attr("fill", "blue");
            svg.selectAll(".director-label")
                .filter(label => label === d)
                .style("opacity", 0);
        });

    svg.append("g")
        .attr("transform", "translate(0," + (h - padding) + ")")
        .call(d3.axisBottom(xScaleDirectors))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("font-weight", 600)
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-45)")
        .attr("font-size", "10px");

    svg.append("g")
        .attr("transform", "translate(" + padding + ",0)")
        .call(d3.axisLeft(yScaleDirectors))
        .selectAll("text")
        .attr("font-weight", 600);

    svg.append("text")
        .attr("x", w / 2)
        .attr("y", h + 60)
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "16px")
        .attr("font-weight", "bold")
        .text("Top 15 Directors by Title Counts");
}


NetflixData((data) => {
    console.log(data)

    //Calling the visualizations here
    visualizeDurationCountsHistogram(data);
    visualizeReleaseYearCountsHistogram(data);
    visualizeDateAddedCountsHistogram(data);
    visualizeRatingCountsHistogram(data);
    visualizeTopDirectorsHistogram(data);



    
});

    </script>

</body>
</html>